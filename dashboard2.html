<html>
<head>

<meta http-equiv="refresh" content="60" >

<style>
  @import url('https://cdn.shopify.com/shopify-marketing_assets/builds/30.6.0/marketing_assets/builds/shopify-sans.css');

  body {
    font-family: ShopifySans, Arial, sans-serif !important;
    background-color: #212B35;
    color: #F4F6F8;
  }
  td {
    font-size: 20px;
    line-height: 24px;
    font-weight: 400;
    height:60px;
  }
  table {
    padding-left: 80px;
  }

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>

const STATUS_URL = "https://buildkite-build-status.herokuapp.com";

function associateImageUrl(img, url, extras) {
  $.ajax({
    url: url
  }).then(function(data) {
    img.attr("src", data + extras)
  });
}

function associatePlatformImage(img, url, platform) {
  $.ajax({
    url: url
  }).then(function(data) {
    img.attr("src", platform + "-" + data + ".png")
  });
}

function makePlatformImg(id, platform, branch) {
  if (platform == "") {
    return null
  }
  var img = $("<img/>")
  img.attr("width", "48px")
  associatePlatformImage(img, STATUS_URL + "/status?id=" + id + "&branch=" + branch, platform)
  return img
}

function makeLogoImg(id, logo) {
  if (logo == "") {
    return null
  }
  var img = $("<img/>")
  img.attr("width", "48px")
  img.attr("src", logo + ".png")
  return img
}

function makeStatusImg(id, branch) {
  var img = $("<img/>");
  img.attr("width", "100px");
  associateImageUrl(img, STATUS_URL + "/badge?id=" + id + "&branch=" + branch, "&theme=95bf46,ed6347,999");
  return img;
}

function makeTable(container, data) {

    var table = $("<table/>").addClass('CSSTableGenerator');
    $.each(data, function(rowIndex, r) {
        var row = $("<tr/>");

        var dataRow = data[rowIndex];
        var id = dataRow[0];
        var platform = dataRow[1];
        var logo = dataRow[2];
        var title = dataRow[3];
        var branch = dataRow[4] || "master";

        row.append($("<td/>").attr("width", "120px").append(makeStatusImg(id, branch)));
        row.append($("<td/>").attr("width", "60px").append(makePlatformImg(id, platform, branch)));
        row.append($("<td/>").attr("width", "60px").append(makeLogoImg(id, logo)));
        row.append($("<td/>").text(title));

        table.append(row);
    });
    return container.append(table);
}

$(document).ready(function() {

    var data =
      [
        ["8889bf9929a117249f40a18e7aab5f4b146d5ea6c6a19c1d18", "apple",    "",            "iOS @ Shopify (master)"],
        ["ea89cfafb96cd5767c813d22133b876aad9e664823c22bc8ae", "apple",    "mosho",       "Shopify Mobile"],
        ["af5298d75ddcf27626f822534fdbbbed6e318d536b97ca09ee", "apple",    "mosho",       "Shopify Mobile Hockey Release", "ci-anka-release"],
        ["722355f0b1cbee5e061cd50b6209415eacfb5b1cb4cabaaeac", "apple",    "mosho",       "Shopify Mobile Release"],
        ["c3f24f8e80aa04fa83a1697df7244c17db811b133dc539a37e", "apple",    "pos_app",     "Point of Sale"],
        ["6a22c6cb651c8a796fe5ad2ebb9b0848ccfce56390ccea76e2", "apple",    "pos_app",     "Point of Sale Hockey Release", "ci-anka-release"],
        ["749b1232b503da51bc4689f8e9afa6896630c7764545b143ad", "apple",    "foundations", "Foundation"],
        ["ba62b1540715d540024d7c23d961f0fe677dcb6225fab8f84a", "apple",    "",            "Merchant Login"],
        ["200d6f13ee86c3a640b219b08c2c1066134f4f0acc48b3ec31", "apple",    "polaris",     "Polaris"],
        ["913521705f4c2b66e72408eb2154aa8292d63d1cb925f9ba27", "apple",    "",            "Testify"],
        ["95b4f4535e17dd65765f0319675643a76c354a272b236df8ce", "android",  "",            "Android @ Shopify (master)"],
        ["ce900af1a4cde4323abb371ab168d50a1f808069210bde01f5", "android",  "mosho",       "Shopify Mobile"],
        ["8a2d89e731cb5c7f9fd30d1a241391a1bc9b0aca3927627a42", "android",  "mosho",       "Shopify Mobile Automation"],
        ["09e5e28a6a3a8dd422e986e7e71902cf071f1f6af8d715b9cf", "android",  "mosho",       "Shopify Mobile Play Store"],
        ["78ef5f6ee4e4c5ff06f48eb3f90ba8b57305c8ed08b698f5e3", "android",  "pos_app",     "Point of Sale"],
        ["325cea36fbbd06bd8ccaecfd786564ae4f4b41e92893885afb", "android",  "pos_app",     "Point Of Sale Integration Tests"],
        ["8350cdee0e44d7809bd87175c37125cb9edb0e9927bbd913f6", "android",  "pos_app",     "Point Of Sale SDK"],
        ["8f0a3de2ce014b0094acf585c4b68348e08fb164dfe4ab610c", "android",  "pos_customer","Point Of Sale Customer View"],
        ["c5491521bd3755598efde6c281f9c973149cda9892ac7a8599", "android",  "foundations", "Foundation"],
        ["e198140085b657fdf5e1eef0e7b1417b7525c4b4b61c22c82f", "android",  "",            "Merchant Login"],
        ["8d72b5bd96e5ce2166e67e54e3e5981e6f817bcc17f7ba1970", "android",  "graphql",     "Merchant SDK"],
        ["74953c3d9a6915475b1589d3b6cb559c0a9422a461253d600d", "android",  "polaris",     "Polaris"],
        ["11a3edc09218415623d5ea0c7a02f03a000c2ac6bb5e53dfa5", "",         "rocky",       "Rocky"],
        ["4772c1833ed5080364730d65c7e7190bc45a086f558e888594", "android",  "",            "Testify"],
        ["1affd0422c06e393e0b9e4dd86784fe6bdaaad494669bfac6f", "android",  "",            "Timeline"],
        ["606b56053e5b2770da654528256c65a4cc9f846e76a9deb554", "android",  "uploadify",   "Uploadify"]
     ]
    makeTable($("#statusTable"), data);
    $("#timestamp").html(Date());
});

</script>
</head>

<body>

<div id="statusTable"></div>
<p id="timestamp"></p>

</body>

</html>